import { __decorate } from "tslib";
import { ChangeDetectorRef, Component, ElementRef, OnInit, ViewChild } from '@angular/core';
import { IconPickerService } from './icon-picker.service';
import { IconType } from './icon';
var IconPickerComponent = /** @class */ (function () {
    function IconPickerComponent(el, cdr, service) {
        this.el = el;
        this.cdr = cdr;
        this.service = service;
        this.iconType = IconType;
        this.dialogArrowSize = 10;
        this.icons = [];
        this.search = '';
    }
    IconPickerComponent.prototype.setDialog = function (instance, elementRef, icon, ipPosition, ipHeight, ipMaxHeight, ipWidth, ipPlaceHolder, ipFallbackIcon, ipIconPack, ipIconSize, ipIconVerticalPadding, ipIconHorizontalPadding, ipButtonStyleClass, ipDivSearchStyleClass, ipInputSearchStyleClass, ipKeepSearchFilter) {
        this.directiveInstance = instance;
        this.setInitialIcon(icon);
        this.directiveElementRef = elementRef;
        this.ipPosition = ipPosition;
        this.ipHeight = parseInt(ipHeight, 10);
        this.ipMaxHeight = parseInt(ipMaxHeight, 10);
        this.ipWidth = parseInt(ipWidth, 10);
        if (!this.ipWidth) {
            this.ipWidth = elementRef.nativeElement.offsetWidth;
        }
        this.ipIconSize = parseInt(ipIconSize, 10);
        this.ipIconVerticalPadding = parseInt(ipIconVerticalPadding, 10);
        this.ipIconHorizontalPadding = parseInt(ipIconHorizontalPadding, 10);
        this.ipKeepSearchFilter = JSON.parse(ipKeepSearchFilter);
        this.ipPlaceHolder = ipPlaceHolder;
        this.ipFallbackIcon = ipFallbackIcon;
        this.ipIconPack = ipIconPack;
        this.ipButtonStyleClass = ipButtonStyleClass;
        this.ipInputSearchStyleClass = ipInputSearchStyleClass;
        this.ipDivSearchStyleClass = ipDivSearchStyleClass;
        this.buttonHeight = this.ipIconSize + 2 * this.ipIconVerticalPadding;
        this.buttonWidth = this.ipIconSize + 2 * this.ipIconHorizontalPadding;
    };
    IconPickerComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.icons = this.service.getIcons(this.ipIconPack);
        this.listenerMouseDown = function (event) { return _this.onMouseDown(event); };
        this.listenerResize = function () { return _this.onResize(); };
        this.openDialog(this.initialIcon);
    };
    IconPickerComponent.prototype.setInitialIcon = function (icon) {
        this.initialIcon = icon;
        this.selectedIcon = this.icons.find(function (el) { return el ?
            "fa fa-" + el.id === icon || "glyphicon glyphicon-" + el.id === icon || "" + el.id === icon :
            false; });
        if (this.ipKeepSearchFilter && this.selectedIcon && icon !== this.ipFallbackIcon) {
            this.search = this.selectedIcon.id;
        }
        else {
            this.search = '';
        }
    };
    IconPickerComponent.prototype.openDialog = function (icon) {
        this.setInitialIcon(icon);
        this.openIconPicker();
    };
    IconPickerComponent.prototype.setSearch = function (val) {
        this.search = val;
    };
    IconPickerComponent.prototype.selectIcon = function (icon) {
        if (icon.type === IconType.FONT_AWESEOME) {
            this.directiveInstance.iconSelected("fa fa-" + icon.id);
        }
        else if (icon.type === IconType.BOOTSTRAP) {
            this.directiveInstance.iconSelected("glyphicon glyphicon-" + icon.id);
        }
        else if (icon.type === IconType.FONT_AWESEOME5) {
            this.directiveInstance.iconSelected("" + icon.id);
        }
        else if (icon.type === IconType.MATERIAL) {
            this.directiveInstance.iconSelected("" + icon.id);
        }
        this.closeIconPicker();
    };
    IconPickerComponent.prototype.onMouseDown = function (event) {
        if (!this.isDescendant(this.el.nativeElement, event.target) && event.target !== this.directiveElementRef.nativeElement) {
            this.closeIconPicker();
        }
    };
    IconPickerComponent.prototype.openIconPicker = function () {
        var _this = this;
        if (!this.show) {
            this.show = true;
            this.hidden = true;
            setTimeout(function () {
                _this.setDialogPosition();
                _this.hidden = false;
                _this.cdr.detectChanges();
            }, 0);
            document.addEventListener('mousedown', this.listenerMouseDown);
            window.addEventListener('resize', this.listenerResize);
        }
    };
    IconPickerComponent.prototype.closeIconPicker = function () {
        if (this.show) {
            this.show = false;
            document.removeEventListener('mousedown', this.listenerMouseDown);
            window.removeEventListener('resize', this.listenerResize);
            this.cdr.detectChanges();
        }
    };
    IconPickerComponent.prototype.onResize = function () {
        if (this.position === 'fixed') {
            this.setDialogPosition();
        }
    };
    IconPickerComponent.prototype.setDialogPosition = function () {
        var dialogHeight = this.dialogElement.nativeElement.offsetHeight;
        var node = this.directiveElementRef.nativeElement;
        var position = 'static';
        var transform = '';
        var parentNode = null;
        var transformNode = null;
        var style = null;
        while (node !== null && node.tagName !== 'HTML') {
            style = window.getComputedStyle(node);
            position = style.getPropertyValue('position');
            transform = style.getPropertyValue('transform');
            if (position !== 'static' && parentNode === null) {
                parentNode = node;
            }
            if (transform && transform !== 'none' && transformNode === null) {
                transformNode = node;
            }
            if (position === 'fixed') {
                parentNode = transformNode;
                break;
            }
            node = node.parentNode;
        }
        var boxDirective = this.createBox(this.directiveElementRef.nativeElement, (position !== 'fixed'));
        if (position !== 'fixed' || parentNode) {
            if (parentNode === null) {
                parentNode = node;
            }
            var boxParent = this.createBox(parentNode, true);
            this.top = boxDirective.top - boxParent.top;
            this.left = boxDirective.left - boxParent.left;
        }
        else {
            this.top = boxDirective.top;
            this.left = boxDirective.left;
        }
        if (position === 'fixed') {
            this.position = 'fixed';
        }
        if (this.ipPosition === 'left') {
            this.left -= this.ipWidth + this.dialogArrowSize - 2;
        }
        else if (this.ipPosition === 'top') {
            this.top -= dialogHeight + this.dialogArrowSize;
            this.arrowTop = dialogHeight - 1;
        }
        else if (this.ipPosition === 'bottom') {
            this.top += boxDirective.height + this.dialogArrowSize;
        }
        else {
            this.left += boxDirective.width + this.dialogArrowSize - 2;
        }
    };
    IconPickerComponent.prototype.isDescendant = function (parent, child) {
        var node = child.parentNode;
        while (node !== null) {
            if (node === parent) {
                return true;
            }
            node = node.parentNode;
        }
        return false;
    };
    IconPickerComponent.prototype.createBox = function (element, offset) {
        return {
            top: element.getBoundingClientRect().top + (offset ? window.pageYOffset : 0),
            left: element.getBoundingClientRect().left + (offset ? window.pageXOffset : 0),
            width: element.offsetWidth,
            height: element.offsetHeight
        };
    };
    IconPickerComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: IconPickerService }
    ]; };
    __decorate([
        ViewChild('dialogPopup')
    ], IconPickerComponent.prototype, "dialogElement", void 0);
    IconPickerComponent = __decorate([
        Component({
            // tslint:disable-next-line: component-selector
            selector: 'icon-picker',
            template: "<div class=\"icon-picker\" #dialogPopup\r\n     [hidden]=\"!show\"\r\n     [style.visibility]=\"this.hidden ? 'hidden' : 'visible'\"\r\n     [style.height.px]=\"ipHeight\"\r\n     [style.width.px]=\"ipWidth\"\r\n     [style.top.px]=\"top\"\r\n     [style.left.px]=\"left\"\r\n     [style.position]=\"position\">\r\n\r\n  <div class=\"arrow arrow-{{ipPosition}}\" [style.top.px]=\"arrowTop\"></div>\r\n\r\n  <div class=\"icon-search {{ipDivSearchStyleClass}}\">\r\n    <input type=\"text\" class=\"{{ipInputSearchStyleClass}}\" [text] [value]=\"search\" (newValue)=\"setSearch($event)\"\r\n           [placeholder]=\"ipPlaceHolder\">\r\n  </div>\r\n  <div class=\"icon-grid\" [ngStyle]=\"{'max-height.px': ipMaxHeight}\">\r\n    <div *ngFor=\"let icon of icons | searchIcon:search\">\r\n      <button *ngIf=\"icon\" class=\"ip-button-icon {{ipButtonStyleClass}}\" type=\"button\" title=\"{{ icon.name }}\"\r\n              [ngClass]=\"{active : icon === selectedIcon}\"\r\n              [style.width.px]=\"buttonWidth\"\r\n              [style.height.px]=\"buttonHeight\"\r\n              [style.padding-top.px]=\"ipIconVerticalPadding\"\r\n              [style.padding-bottom.px]=\"ipIconVerticalPadding\"\r\n              [style.padding-left.px]=\"ipIconHorizontalPadding\"\r\n              [style.padding-right.px]=\"ipIconHorizontalPadding\"\r\n              (click)=\"selectIcon(icon)\">\r\n        <span *ngIf=\"icon.type === iconType.FONT_AWESEOME\" class=\"fa fa-{{icon.id}}\"\r\n              [style.font-size.px]=\"ipIconSize\"></span>\r\n        <span *ngIf=\"icon.type === iconType.BOOTSTRAP\" class=\"glyphicon glyphicon-{{icon.id}}\"\r\n              [style.font-size.px]=\"ipIconSize\"></span>\r\n        <span *ngIf=\"icon.type === iconType.FONT_AWESEOME5\" class=\"{{icon.id}}\"\r\n              [style.font-size.px]=\"ipIconSize\"></span>\r\n        <span *ngIf=\"icon.type === iconType.MATERIAL\" class=\"material-icons\"\r\n              [style.font-size.px]=\"ipIconSize\">{{icon.id}}</span>\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n",
            styles: [".icon-picker{box-sizing:border-box;margin:0;position:absolute;z-index:100000;top:250px;left:30px;width:230px;height:auto;border:1px solid #777;cursor:default;background-color:#fff;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.icon-picker i{position:relative;cursor:default}.icon-picker .arrow{position:absolute;z-index:999999;width:0;height:0;border-style:solid}.icon-picker .arrow-right{top:10px;left:-20px;border-width:5px 10px;border-color:transparent #777 transparent transparent}.icon-picker .arrow-left{top:10px;left:100%;border-width:5px 10px;border-color:transparent transparent transparent #777}.icon-picker .arrow-bottom{top:-20px;left:10px;border-width:10px 5px;border-color:transparent transparent #777}.icon-picker .arrow-top{left:10px;border-width:10px 5px;border-color:#777 transparent transparent}.icon-picker div.icon-search{padding:5px}.icon-picker div.icon-grid{display:-webkit-box;display:flex;overflow-y:auto;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;padding:5px}.icon-picker div.icon-grid div{margin:2px}.icon-picker div.cursor-sv{position:relative;width:15px;height:15px;border-radius:50%;border:1px solid #ddd;cursor:default}.icon-picker div.cursor{position:relative;width:16px;height:16px;border-radius:50%;border:2px solid #222;cursor:default}"]
        })
    ], IconPickerComponent);
    return IconPickerComponent;
}());
export { IconPickerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWNvbi1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWljb24tcGlja2VyLyIsInNvdXJjZXMiOlsibGliL2ljb24tcGlja2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUUxRixPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQU8sUUFBUSxFQUFDLE1BQU0sUUFBUSxDQUFDO0FBU3RDO0lBNkNFLDZCQUNVLEVBQWMsRUFDZCxHQUFzQixFQUN0QixPQUEwQjtRQUYxQixPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2QsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsWUFBTyxHQUFQLE9BQU8sQ0FBbUI7UUFyQjdCLGFBQVEsR0FBRyxRQUFRLENBQUM7UUFXbkIsb0JBQWUsR0FBRyxFQUFFLENBQUM7UUFJN0IsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUNuQixXQUFNLEdBQUcsRUFBRSxDQUFDO0lBTVosQ0FBQztJQUVELHVDQUFTLEdBQVQsVUFBVSxRQUFhLEVBQUUsVUFBc0IsRUFBRSxJQUFZLEVBQUUsVUFBa0IsRUFBRSxRQUFnQixFQUFFLFdBQW1CLEVBQzlHLE9BQWUsRUFBRSxhQUFxQixFQUFFLGNBQXNCLEVBQUUsVUFBb0IsRUFBRSxVQUFrQixFQUN4RyxxQkFBNkIsRUFBRSx1QkFBK0IsRUFBRSxrQkFBMEIsRUFBRSxxQkFBNkIsRUFDekgsdUJBQStCLEVBQUUsa0JBQTBCO1FBQ25FLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxRQUFRLENBQUM7UUFDbEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsVUFBVSxDQUFDO1FBQ3RDLElBQUksQ0FB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ZiwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBPbkluaXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQge0ljb25QaWNrZXJTZXJ2aWNlfSBmcm9tICcuL2ljb24tcGlja2VyLnNlcnZpY2UnO1xyXG5pbXBvcnQge0ljb24sIEljb25UeXBlfSBmcm9tICcuL2ljb24nO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBjb21wb25lbnQtc2VsZWN0b3JcclxuICBzZWxlY3RvcjogJ2ljb24tcGlja2VyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vaWNvbi1waWNrZXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2ljb24tcGlja2VyLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBJY29uUGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAvLyBQb3BvdmVyXHJcbiAgcHVibGljIGlwUG9zaXRpb246IHN0cmluZztcclxuICBwdWJsaWMgaXBIZWlnaHQ6IG51bWJlcjtcclxuICBwdWJsaWMgaXBNYXhIZWlnaHQ6IG51bWJlcjtcclxuICBwdWJsaWMgaXBXaWR0aDogbnVtYmVyO1xyXG4gIC8vIEljb24gY3NzXHJcbiAgcHVibGljIGlwSWNvblNpemU6IG51bWJlcjtcclxuICBwdWJsaWMgaXBJY29uVmVydGljYWxQYWRkaW5nOiBudW1iZXI7XHJcbiAgcHVibGljIGlwSWNvbkhvcml6b250YWxQYWRkaW5nOiBudW1iZXI7XHJcbiAgLy8gSXRlbSBTdHlsZSBpZSBpbnB1dCBhbmQgYnV0dG9uXHJcbiAgcHVibGljIGlwQnV0dG9uU3R5bGVDbGFzczogc3RyaW5nO1xyXG4gIHB1YmxpYyBpcElucHV0U2VhcmNoU3R5bGVDbGFzczogc3RyaW5nO1xyXG4gIHB1YmxpYyBpcERpdlNlYXJjaFN0eWxlQ2xhc3M6IHN0cmluZztcclxuICAvLyBJY29uIGFuZCBiZWhhdmlvcnNcclxuICBwdWJsaWMgaXBLZWVwU2VhcmNoRmlsdGVyOiBib29sZWFuO1xyXG4gIHB1YmxpYyBpcFBsYWNlSG9sZGVyOiBzdHJpbmc7XHJcbiAgcHVibGljIGlwRmFsbGJhY2tJY29uOiBzdHJpbmc7XHJcbiAgcHVibGljIGlwSWNvblBhY2s6IHN0cmluZ1tdO1xyXG5cclxuICBwdWJsaWMgc2hvdzogYm9vbGVhbjtcclxuICBwdWJsaWMgaGlkZGVuOiBib29sZWFuO1xyXG4gIHB1YmxpYyB0b3A6IG51bWJlcjtcclxuICBwdWJsaWMgbGVmdDogbnVtYmVyO1xyXG4gIHB1YmxpYyBwb3NpdGlvbjogc3RyaW5nO1xyXG4gIHB1YmxpYyBhcnJvd1RvcDogbnVtYmVyO1xyXG4gIHB1YmxpYyBzZWxlY3RlZEljb246IEljb247XHJcbiAgcHVibGljIGljb25UeXBlID0gSWNvblR5cGU7XHJcbiAgcHVibGljIGJ1dHRvbldpZHRoOiBudW1iZXI7XHJcbiAgcHVibGljIGJ1dHRvbkhlaWdodDogbnVtYmVyO1xyXG5cclxuICBwcml2YXRlIGRpcmVjdGl2ZUluc3RhbmNlOiBhbnk7XHJcbiAgcHJpdmF0ZSBpbml0aWFsSWNvbjogc3RyaW5nO1xyXG4gIHByaXZhdGUgZGlyZWN0aXZlRWxlbWVudFJlZjogRWxlbWVudFJlZjtcclxuXHJcbiAgcHJpdmF0ZSBsaXN0ZW5lck1vdXNlRG93bjogYW55O1xyXG4gIHByaXZhdGUgbGlzdGVuZXJSZXNpemU6IGFueTtcclxuXHJcbiAgcHJpdmF0ZSBkaWFsb2dBcnJvd1NpemUgPSAxMDtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZGlhbG9nUG9wdXAnKSBkaWFsb2dFbGVtZW50OiBhbnk7XHJcblxyXG4gIGljb25zOiBJY29uW10gPSBbXTtcclxuICBzZWFyY2ggPSAnJztcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxyXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgcHJpdmF0ZSBzZXJ2aWNlOiBJY29uUGlja2VyU2VydmljZSkge1xyXG4gIH1cclxuXHJcbiAgc2V0RGlhbG9nKGluc3RhbmNlOiBhbnksIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIGljb246IHN0cmluZywgaXBQb3NpdGlvbjogc3RyaW5nLCBpcEhlaWdodDogc3RyaW5nLCBpcE1heEhlaWdodDogc3RyaW5nLFxyXG4gICAgICAgICAgICBpcFdpZHRoOiBzdHJpbmcsIGlwUGxhY2VIb2xkZXI6IHN0cmluZywgaXBGYWxsYmFja0ljb246IHN0cmluZywgaXBJY29uUGFjazogc3RyaW5nW10sIGlwSWNvblNpemU6IHN0cmluZyxcclxuICAgICAgICAgICAgaXBJY29uVmVydGljYWxQYWRkaW5nOiBzdHJpbmcsIGlwSWNvbkhvcml6b250YWxQYWRkaW5nOiBzdHJpbmcsIGlwQnV0dG9uU3R5bGVDbGFzczogc3RyaW5nLCBpcERpdlNlYXJjaFN0eWxlQ2xhc3M6IHN0cmluZyxcclxuICAgICAgICAgICAgaXBJbnB1dFNlYXJjaFN0eWxlQ2xhc3M6IHN0cmluZywgaXBLZWVwU2VhcmNoRmlsdGVyOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuZGlyZWN0aXZlSW5zdGFuY2UgPSBpbnN0YW5jZTtcclxuICAgIHRoaXMuc2V0SW5pdGlhbEljb24oaWNvbik7XHJcbiAgICB0aGlzLmRpcmVjdGl2ZUVsZW1lbnRSZWYgPSBlbGVtZW50UmVmO1xyXG4gICAgdGhpcy5pcFBvc2l0aW9uID0gaXBQb3NpdGlvbjtcclxuICAgIHRoaXMuaXBIZWlnaHQgPSBwYXJzZUludChpcEhlaWdodCwgMTApO1xyXG4gICAgdGhpcy5pcE1heEhlaWdodCA9IHBhcnNlSW50KGlwTWF4SGVpZ2h0LCAxMCk7XHJcbiAgICB0aGlzLmlwV2lkdGggPSBwYXJzZUludChpcFdpZHRoLCAxMCk7XHJcbiAgICBpZiAoIXRoaXMuaXBXaWR0aCkge1xyXG4gICAgICB0aGlzLmlwV2lkdGggPSBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XHJcbiAgICB9XHJcbiAgICB0aGlzLmlwSWNvblNpemUgPSBwYXJzZUludChpcEljb25TaXplLCAxMCk7XHJcbiAgICB0aGlzLmlwSWNvblZlcnRpY2FsUGFkZGluZyA9IHBhcnNlSW50KGlwSWNvblZlcnRpY2FsUGFkZGluZywgMTApO1xyXG4gICAgdGhpcy5pcEljb25Ib3Jpem9udGFsUGFkZGluZyA9IHBhcnNlSW50KGlwSWNvbkhvcml6b250YWxQYWRkaW5nLCAxMCk7XHJcbiAgICB0aGlzLmlwS2VlcFNlYXJjaEZpbHRlciA9IEpTT04ucGFyc2UoaXBLZWVwU2VhcmNoRmlsdGVyKTtcclxuICAgIHRoaXMuaXBQbGFjZUhvbGRlciA9IGlwUGxhY2VIb2xkZXI7XHJcbiAgICB0aGlzLmlwRmFsbGJhY2tJY29uID0gaXBGYWxsYmFja0ljb247XHJcbiAgICB0aGlzLmlwSWNvblBhY2sgPSBpcEljb25QYWNrO1xyXG4gICAgdGhpcy5pcEJ1dHRvblN0eWxlQ2xhc3MgPSBpcEJ1dHRvblN0eWxlQ2xhc3M7XHJcbiAgICB0aGlzLmlwSW5wdXRTZWFyY2hTdHlsZUNsYXNzID0gaXBJbnB1dFNlYXJjaFN0eWxlQ2xhc3M7XHJcbiAgICB0aGlzLmlwRGl2U2VhcmNoU3R5bGVDbGFzcyA9IGlwRGl2U2VhcmNoU3R5bGVDbGFzcztcclxuXHJcbiAgICB0aGlzLmJ1dHRvbkhlaWdodCA9IHRoaXMuaXBJY29uU2l6ZSArIDIgKiB0aGlzLmlwSWNvblZlcnRpY2FsUGFkZGluZztcclxuICAgIHRoaXMuYnV0dG9uV2lkdGggPSB0aGlzLmlwSWNvblNpemUgKyAyICogdGhpcy5pcEljb25Ib3Jpem9udGFsUGFkZGluZztcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5pY29ucyA9IHRoaXMuc2VydmljZS5nZXRJY29ucyh0aGlzLmlwSWNvblBhY2spO1xyXG4gICAgdGhpcy5saXN0ZW5lck1vdXNlRG93biA9IChldmVudDogYW55KSA9PiB0aGlzLm9uTW91c2VEb3duKGV2ZW50KTtcclxuICAgIHRoaXMubGlzdGVuZXJSZXNpemUgPSAoKSA9PiB0aGlzLm9uUmVzaXplKCk7XHJcbiAgICB0aGlzLm9wZW5EaWFsb2codGhpcy5pbml0aWFsSWNvbik7XHJcbiAgfVxyXG5cclxuICBzZXRJbml0aWFsSWNvbihpY29uOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuaW5pdGlhbEljb24gPSBpY29uO1xyXG4gICAgdGhpcy5zZWxlY3RlZEljb24gPSB0aGlzLmljb25zLmZpbmQoZWwgPT4gZWwgP1xyXG4gICAgICBgZmEgZmEtJHtlbC5pZH1gID09PSBpY29uIHx8IGBnbHlwaGljb24gZ2x5cGhpY29uLSR7ZWwuaWR9YCA9PT0gaWNvbiB8fCBgJHtlbC5pZH1gID09PSBpY29uIDpcclxuICAgICAgZmFsc2VcclxuICAgICk7XHJcbiAgICBpZiAodGhpcy5pcEtlZXBTZWFyY2hGaWx0ZXIgJiYgdGhpcy5zZWxlY3RlZEljb24gJiYgaWNvbiAhPT0gdGhpcy5pcEZhbGxiYWNrSWNvbikge1xyXG4gICAgICB0aGlzLnNlYXJjaCA9IHRoaXMuc2VsZWN0ZWRJY29uLmlkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zZWFyY2ggPSAnJztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9wZW5EaWFsb2coaWNvbjogc3RyaW5nKSB7XHJcbiAgICB0aGlzLnNldEluaXRpYWxJY29uKGljb24pO1xyXG4gICAgdGhpcy5vcGVuSWNvblBpY2tlcigpO1xyXG4gIH1cclxuXHJcbiAgc2V0U2VhcmNoKHZhbDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLnNlYXJjaCA9IHZhbDtcclxuICB9XHJcblxyXG4gIHNlbGVjdEljb24oaWNvbjogSWNvbik6IHZvaWQge1xyXG4gICAgaWYgKGljb24udHlwZSA9PT0gSWNvblR5cGUuRk9OVF9BV0VTRU9NRSkge1xyXG4gICAgICB0aGlzLmRpcmVjdGl2ZUluc3RhbmNlLmljb25TZWxlY3RlZChgZmEgZmEtJHtpY29uLmlkfWApO1xyXG4gICAgfSBlbHNlIGlmIChpY29uLnR5cGUgPT09IEljb25UeXBlLkJPT1RTVFJBUCkge1xyXG4gICAgICB0aGlzLmRpcmVjdGl2ZUluc3RhbmNlLmljb25TZWxlY3RlZChgZ2x5cGhpY29uIGdseXBoaWNvbi0ke2ljb24uaWR9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGljb24udHlwZSA9PT0gSWNvblR5cGUuRk9OVF9BV0VTRU9NRTUpIHtcclxuICAgICAgdGhpcy5kaXJlY3RpdmVJbnN0YW5jZS5pY29uU2VsZWN0ZWQoYCR7aWNvbi5pZH1gKTtcclxuICAgIH0gZWxzZSBpZiAoaWNvbi50eXBlID09PSBJY29uVHlwZS5NQVRFUklBTCkge1xyXG4gICAgICB0aGlzLmRpcmVjdGl2ZUluc3RhbmNlLmljb25TZWxlY3RlZChgJHtpY29uLmlkfWApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jbG9zZUljb25QaWNrZXIoKTtcclxuICB9XHJcblxyXG4gIG9uTW91c2VEb3duKGV2ZW50OiBhbnkpIHtcclxuICAgIGlmICghdGhpcy5pc0Rlc2NlbmRhbnQodGhpcy5lbC5uYXRpdmVFbGVtZW50LCBldmVudC50YXJnZXQpICYmIGV2ZW50LnRhcmdldCAhPT0gdGhpcy5kaXJlY3RpdmVFbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpIHtcclxuICAgICAgdGhpcy5jbG9zZUljb25QaWNrZXIoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9wZW5JY29uUGlja2VyKCkge1xyXG4gICAgaWYgKCF0aGlzLnNob3cpIHtcclxuICAgICAgdGhpcy5zaG93ID0gdHJ1ZTtcclxuICAgICAgdGhpcy5oaWRkZW4gPSB0cnVlO1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLnNldERpYWxvZ1Bvc2l0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5oaWRkZW4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgIH0sIDApO1xyXG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLmxpc3RlbmVyTW91c2VEb3duKTtcclxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMubGlzdGVuZXJSZXNpemUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xvc2VJY29uUGlja2VyKCkge1xyXG4gICAgaWYgKHRoaXMuc2hvdykge1xyXG4gICAgICB0aGlzLnNob3cgPSBmYWxzZTtcclxuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5saXN0ZW5lck1vdXNlRG93bik7XHJcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLmxpc3RlbmVyUmVzaXplKTtcclxuICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb25SZXNpemUoKSB7XHJcbiAgICBpZiAodGhpcy5wb3NpdGlvbiA9PT0gJ2ZpeGVkJykge1xyXG4gICAgICB0aGlzLnNldERpYWxvZ1Bvc2l0aW9uKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXREaWFsb2dQb3NpdGlvbigpIHtcclxuICAgIGNvbnN0IGRpYWxvZ0hlaWdodCA9IHRoaXMuZGlhbG9nRWxlbWVudC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcclxuICAgIGxldCBub2RlID0gdGhpcy5kaXJlY3RpdmVFbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICBsZXQgcG9zaXRpb24gPSAnc3RhdGljJztcclxuICAgIGxldCB0cmFuc2Zvcm0gPSAnJztcclxuICAgIGxldCBwYXJlbnROb2RlOiBhbnkgPSBudWxsO1xyXG4gICAgbGV0IHRyYW5zZm9ybU5vZGU6IGFueSA9IG51bGw7XHJcbiAgICBsZXQgc3R5bGU6IGFueSA9IG51bGw7XHJcbiAgICB3aGlsZSAobm9kZSAhPT0gbnVsbCAmJiBub2RlLnRhZ05hbWUgIT09ICdIVE1MJykge1xyXG4gICAgICBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKG5vZGUpO1xyXG4gICAgICBwb3NpdGlvbiA9IHN0eWxlLmdldFByb3BlcnR5VmFsdWUoJ3Bvc2l0aW9uJyk7XHJcbiAgICAgIHRyYW5zZm9ybSA9IHN0eWxlLmdldFByb3BlcnR5VmFsdWUoJ3RyYW5zZm9ybScpO1xyXG4gICAgICBpZiAocG9zaXRpb24gIT09ICdzdGF0aWMnICYmIHBhcmVudE5vZGUgPT09IG51bGwpIHtcclxuICAgICAgICBwYXJlbnROb2RlID0gbm9kZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodHJhbnNmb3JtICYmIHRyYW5zZm9ybSAhPT0gJ25vbmUnICYmIHRyYW5zZm9ybU5vZGUgPT09IG51bGwpIHtcclxuICAgICAgICB0cmFuc2Zvcm1Ob2RlID0gbm9kZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAocG9zaXRpb24gPT09ICdmaXhlZCcpIHtcclxuICAgICAgICBwYXJlbnROb2RlID0gdHJhbnNmb3JtTm9kZTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYm94RGlyZWN0aXZlID0gdGhpcy5jcmVhdGVCb3godGhpcy5kaXJlY3RpdmVFbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIChwb3NpdGlvbiAhPT0gJ2ZpeGVkJykpO1xyXG4gICAgaWYgKHBvc2l0aW9uICE9PSAnZml4ZWQnIHx8IHBhcmVudE5vZGUpIHtcclxuICAgICAgaWYgKHBhcmVudE5vZGUgPT09IG51bGwpIHtcclxuICAgICAgICBwYXJlbnROb2RlID0gbm9kZTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBib3hQYXJlbnQgPSB0aGlzLmNyZWF0ZUJveChwYXJlbnROb2RlLCB0cnVlKTtcclxuICAgICAgdGhpcy50b3AgPSBib3hEaXJlY3RpdmUudG9wIC0gYm94UGFyZW50LnRvcDtcclxuICAgICAgdGhpcy5sZWZ0ID0gYm94RGlyZWN0aXZlLmxlZnQgLSBib3hQYXJlbnQubGVmdDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudG9wID0gYm94RGlyZWN0aXZlLnRvcDtcclxuICAgICAgdGhpcy5sZWZ0ID0gYm94RGlyZWN0aXZlLmxlZnQ7XHJcbiAgICB9XHJcbiAgICBpZiAocG9zaXRpb24gPT09ICdmaXhlZCcpIHtcclxuICAgICAgdGhpcy5wb3NpdGlvbiA9ICdmaXhlZCc7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5pcFBvc2l0aW9uID09PSAnbGVmdCcpIHtcclxuICAgICAgdGhpcy5sZWZ0IC09IHRoaXMuaXBXaWR0aCArIHRoaXMuZGlhbG9nQXJyb3dTaXplIC0gMjtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5pcFBvc2l0aW9uID09PSAndG9wJykge1xyXG4gICAgICB0aGlzLnRvcCAtPSBkaWFsb2dIZWlnaHQgKyB0aGlzLmRpYWxvZ0Fycm93U2l6ZTtcclxuICAgICAgdGhpcy5hcnJvd1RvcCA9IGRpYWxvZ0hlaWdodCAtIDE7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXBQb3NpdGlvbiA9PT0gJ2JvdHRvbScpIHtcclxuICAgICAgdGhpcy50b3AgKz0gYm94RGlyZWN0aXZlLmhlaWdodCArIHRoaXMuZGlhbG9nQXJyb3dTaXplO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5sZWZ0ICs9IGJveERpcmVjdGl2ZS53aWR0aCArIHRoaXMuZGlhbG9nQXJyb3dTaXplIC0gMjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlzRGVzY2VuZGFudChwYXJlbnQ6IGFueSwgY2hpbGQ6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgbGV0IG5vZGU6IGFueSA9IGNoaWxkLnBhcmVudE5vZGU7XHJcbiAgICB3aGlsZSAobm9kZSAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAobm9kZSA9PT0gcGFyZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZUJveChlbGVtZW50OiBhbnksIG9mZnNldDogYm9vbGVhbik6IGFueSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3A6IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgKG9mZnNldCA/IHdpbmRvdy5wYWdlWU9mZnNldCA6IDApLFxyXG4gICAgICBsZWZ0OiBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgKyAob2Zmc2V0ID8gd2luZG93LnBhZ2VYT2Zmc2V0IDogMCksXHJcbiAgICAgIHdpZHRoOiBlbGVtZW50Lm9mZnNldFdpZHRoLFxyXG4gICAgICBoZWlnaHQ6IGVsZW1lbnQub2Zmc2V0SGVpZ2h0XHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iXX0=